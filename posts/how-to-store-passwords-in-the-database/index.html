<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>How to store passwords in the database? - caubechankiu's miscellaneous notes</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Việc lưu trữ mật khẩu một cách an toàn trong cơ sở dữ liệu là một vấn đề quan trọng trong thiết kế hệ thống. Làm thế nào để chúng ta xác thực mật khẩu người dùng nhập vào so với những gì chúng ta lưu trữ trong cơ sở dữ liệu?"><meta property="og:image" content><meta property="og:url" content="https://caubechankiu.github.io/posts/how-to-store-passwords-in-the-database/"><meta property="og:site_name" content="caubechankiu's miscellaneous notes"><meta property="og:title" content="How to store passwords in the database?"><meta property="og:description" content="Việc lưu trữ mật khẩu một cách an toàn trong cơ sở dữ liệu là một vấn đề quan trọng trong thiết kế hệ thống. Làm thế nào để chúng ta xác thực mật khẩu người dùng nhập vào so với những gì chúng ta lưu trữ trong cơ sở dữ liệu?"><meta property="og:locale" content="vi_VN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-15T10:00:00+07:00"><meta property="article:modified_time" content="2023-07-15T10:00:00+07:00"><meta property="article:tag" content="Security"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to store passwords in the database?"><meta name=twitter:description content="Việc lưu trữ mật khẩu một cách an toàn trong cơ sở dữ liệu là một vấn đề quan trọng trong thiết kế hệ thống. Làm thế nào để chúng ta xác thực mật khẩu người dùng nhập vào so với những gì chúng ta lưu trữ trong cơ sở dữ liệu?"><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://caubechankiu.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://caubechankiu.github.io/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet type=text/css href=https://caubechankiu.github.io/css/archie.90f4a1321261c2df9485c29a7877582160bb95d018fefaa5f2199bccf7b169f5.css></head><body><div class=content><header><div class=main><a href=https://caubechankiu.github.io/>caubechankiu's miscellaneous notes</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()><svg class="feather"><use href="https://unpkg.com/feather-icons@4.29.2/dist/feather-sprite.svg#sun"/></svg></span>
<script src=https://caubechankiu.github.io/js/themetoggle.js></script></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>How to store passwords in the database?</h1><div class=meta>Posted on Jul 15, 2023</div></div><section class=body><p>Việc lưu trữ mật khẩu một cách an toàn trong cơ sở dữ liệu là một vấn đề quan trọng trong thiết kế hệ thống. Làm thế nào để chúng ta xác thực mật khẩu người dùng nhập vào so với những gì chúng ta lưu trữ trong cơ sở dữ liệu?</p><h2 id=điều-không-nên-làm>Điều không nên làm</h2><p>Trước tiên, hãy nói về những điều không nên làm. <strong>Không bao giờ lưu trữ mật khẩu dưới dạng văn bản thuần (plain text)</strong>. Nếu làm vậy, bất kỳ ai có quyền truy cập nội bộ vào cơ sở dữ liệu đều có thể nhìn thấy chúng. Nếu cơ sở dữ liệu bị xâm phạm, kẻ tấn công có thể dễ dàng lấy được tất cả mật khẩu.</p><h2 id=hướng-dẫn-từ-owasp>Hướng dẫn từ OWASP</h2><p>OWASP - Open Web Application Security Project đã cung cấp một số hướng dẫn về cách lưu trữ mật khẩu. Dưới đây là những khuyến nghị chính:</p><h3 id=1-sử-dụng-thuật-toán-băm-hashing-hiện-đại>1. Sử dụng thuật toán băm (hashing) hiện đại</h3><p>Băm là một hàm một chiều. Điều này có nghĩa là không thể giải mã một giá trị đã băm để lấy lại giá trị ban đầu. Nếu kẻ tấn công lấy được mật khẩu đã băm, họ không thể chỉ nhập nó vào ứng dụng để có quyền truy cập.<figure class=center><img src=/posts/how-to-store-passwords-in-the-database/image1.png width=500px></figure></p><p>Điều quan trọng là sử dụng một hàm băm hiện đại được thiết kế để lưu trữ mật khẩu một cách an toàn. Những hàm này đôi khi được đặc trưng là các hàm &ldquo;chậm&rdquo; sử dụng nhiều tài nguyên hơn để tính toán. Điều này làm cho các cuộc tấn công vét cạn (brute force) trở nên kém hấp dẫn.</p><p>Lưu ý rằng một số hàm băm phổ biến cũ như MD5 và SHA-1 là &ldquo;nhanh&rdquo;. Chúng kém an toàn hơn và không nên được sử dụng.</p><h3 id=2-thêm-muối-salt-vào-mật-khẩu>2. Thêm muối (salt) vào mật khẩu</h3><p>Theo hướng dẫn của OWASP, muối là một chuỗi ngẫu nhiên độc nhất được thêm vào mỗi mật khẩu như một phần của quá trình băm.</p><p>Tại sao chúng ta cần thêm muối vào mật khẩu? Việc lưu trữ mật khẩu dưới dạng băm một chiều là một bước đi đúng hướng, nhưng chưa đủ. Kẻ tấn công có thể đánh bại các hàm băm một chiều với các cuộc tấn công tính toán trước. Một số kỹ thuật tấn công phổ biến là bảng cầu vồng (rainbow tables) và tra cứu dựa trên cơ sở dữ liệu. Với những kỹ thuật này, một hacker có thể phá vỡ mật khẩu trong vài giây.</p><p>Bằng cách thêm muối độc nhất cho mỗi mật khẩu vào quá trình băm, nó đảm bảo rằng giá trị băm là độc nhất cho mỗi mật khẩu. Kỹ thuật đơn giản này làm cho các cuộc tấn công tính toán trước trở nên kém hấp dẫn.<figure class=center><img src=/posts/how-to-store-passwords-in-the-database/image2.png width=500px></figure></p><h4 id=quy-trình-lưu-trữ-mật-khẩu-với-muối>Quy trình lưu trữ mật khẩu với muối</h4><p>Hãy xem xét cách chúng ta lưu trữ mật khẩu với muối:</p><ol><li>Đầu tiên, chúng ta kết hợp mật khẩu do người dùng cung cấp với muối được tạo ngẫu nhiên.</li><li>Sau đó, chúng ta tính toán giá trị băm của sự kết hợp này bằng cách sử dụng một hàm băm thích hợp.</li><li>Giá trị băm được lưu trữ trong cơ sở dữ liệu cùng với muối.</li></ol><figure class=center><img src=/posts/how-to-store-passwords-in-the-database/image3.png width=500px></figure><p>Muối được sử dụng để tạo ra một giá trị băm độc nhất. Nó không phải là bí mật và có thể được lưu trữ an toàn dưới dạng văn bản thuần trong cơ sở dữ liệu.</p><h4 id=quy-trình-xác-thực-mật-khẩu>Quy trình xác thực mật khẩu</h4><p>Cuối cùng, hãy xem xét quy trình ngược lại. Khi người dùng đăng nhập, làm thế nào chúng ta xác thực mật khẩu so với những gì được lưu trữ trong cơ sở dữ liệu?</p><ol><li>Đầu tiên, chúng ta lấy muối cho người dùng từ cơ sở dữ liệu.</li><li>Sau đó, chúng ta thêm muối vào mật khẩu do người dùng cung cấp và băm nó.</li><li>Chúng ta so sánh giá trị băm được tính toán này với giá trị băm được lưu trữ trong cơ sở dữ liệu.</li><li>Nếu chúng giống nhau, mật khẩu là hợp lệ.</li></ol><figure class=center><img src=/posts/how-to-store-passwords-in-the-database/image4.png width=500px></figure><h4 id=migrate>Migrate</h4><p>Làm thế nào migrate một hệ thống dùng SHA1 –> bcrypt. Ở đây có 2 trường hợp:</p><ul><li>Hash password bằng SHA1 nhưng không có salt -> mình gọi là sha1_value. Với trường hợp này ta cần sinh ra thêm salt-per-user và migrate bcrypt(salt, sha1_value) trong đó sha1_value = SHA1(password)</li><li>Hash password bằng SHA1 + trong DB có salt-per-user, mình có sha1_value, salt. Với trường hợp này thì hơi lằng nhằng hơn 1 xíu, ta cần migrate kiểu bcrypt(salt, SHA1(salt, password)) nếu thực sự muốn bcrypt với salt hoặc thực ra chỉ cần bcrypt(SHA1(salt, password)) cũng được. Tùy tình huống bạn cần tradeoff có thể lựa chọn cách phù hợp.</li></ul></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/security>security</a></li></ul></nav></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/caubechankiu rel=me title=GitHub><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a><a class=soc href=https://www.facebook.com/trinhthevils rel=me title=Facebook><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#facebook"/></svg></a><a class=border></a></div><div class=footer-info>2025 © caubechankiu | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>