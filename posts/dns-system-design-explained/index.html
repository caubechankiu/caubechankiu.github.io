<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Hệ thống DNS: Thiết kế và Hoạt động - caubechankiu's miscellaneous notes</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="DNS (Domain Name System) là xương sống của internet, nhưng ít người biết chính xác cách nó hoạt động. Tìm hiểu về thiết kế hệ thống DNS và cách nó dịch tên miền thành địa chỉ IP."><meta property="og:image" content><meta property="og:url" content="https://caubechankiu.github.io/posts/dns-system-design-explained/"><meta property="og:site_name" content="caubechankiu's miscellaneous notes"><meta property="og:title" content="Hệ thống DNS: Thiết kế và Hoạt động"><meta property="og:description" content="DNS (Domain Name System) là xương sống của internet, nhưng ít người biết chính xác cách nó hoạt động. Tìm hiểu về thiết kế hệ thống DNS và cách nó dịch tên miền thành địa chỉ IP."><meta property="og:locale" content="vi_VN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-10T10:00:00+07:00"><meta property="article:modified_time" content="2024-10-10T10:00:00+07:00"><meta property="article:tag" content="Dns"><meta property="article:tag" content="Networking"><meta property="article:tag" content="Internet"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hệ thống DNS: Thiết kế và Hoạt động"><meta name=twitter:description content="DNS (Domain Name System) là xương sống của internet, nhưng ít người biết chính xác cách nó hoạt động. Tìm hiểu về thiết kế hệ thống DNS và cách nó dịch tên miền thành địa chỉ IP."><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://caubechankiu.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://caubechankiu.github.io/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet type=text/css href=https://caubechankiu.github.io/css/archie.90f4a1321261c2df9485c29a7877582160bb95d018fefaa5f2199bccf7b169f5.css></head><body><div class=content><header><div class=main><a href=https://caubechankiu.github.io/>caubechankiu's miscellaneous notes</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()><svg class="feather"><use href="https://unpkg.com/feather-icons@4.29.2/dist/feather-sprite.svg#sun"/></svg></span>
<script src=https://caubechankiu.github.io/js/themetoggle.js></script></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>Hệ thống DNS: Thiết kế và Hoạt động</h1><div class=meta>Posted on Oct 10, 2024</div></div><section class=body><p>DNS (Domain Name System) là xương sống của internet, nhưng ít người biết chính xác cách nó hoạt động. Trong bài viết này, chúng ta sẽ tìm hiểu tất cả về thiết kế hệ thống DNS.</p><h2 id=dns-là-gì>DNS là gì?</h2><p>DNS là thư mục của internet. Nó dịch các tên miền mà con người có thể đọc được, chẳng hạn như google.com, thành các địa chỉ IP mà máy tính có thể hiểu được.</p><p>DNS có thể gây nhầm lẫn vì có nhiều loại máy chủ DNS khác nhau trong hệ thống phân cấp DNS, mỗi loại phục vụ một mục đích khác nhau.</p><h2 id=cách-thức-hoạt-động-của-dns>Cách thức hoạt động của DNS</h2><p>Khi trình duyệt thực hiện một truy vấn DNS, nó đang hỏi một DNS resolver. DNS resolver này có thể đến từ ISP của chúng ta, hoặc từ các nhà cung cấp DNS phổ biến như Cloudflare (1.1.1.1) hoặc Google (8.8.8.8).</p><p>Nếu DNS resolver không có câu trả lời trong bộ nhớ cache của nó, nó sẽ tìm máy chủ tên có thẩm quyền phù hợp và hỏi nó. Máy chủ tên có thẩm quyền là máy chủ giữ câu trả lời.</p><p>Khi chúng ta cập nhật bản ghi DNS của một tên miền, chúng ta đang cập nhật máy chủ tên có thẩm quyền của nó.</p><h2 id=hệ-thống-phân-cấp-dns>Hệ thống phân cấp DNS</h2><p>Làm thế nào để DNS resolver tìm thấy máy chủ tên có thẩm quyền? Đây là nơi hệ thống DNS trở nên thú vị.</p><p><img src=image.png alt></p><p>Có ba cấp độ chính của máy chủ DNS có thẩm quyền:</p><h3 id=1-root-name-servers-máy-chủ-tên-gốc>1. Root Name Servers (Máy chủ tên gốc)</h3><ul><li>Lưu trữ địa chỉ IP của các máy chủ tên TLD</li><li>Có 13 máy chủ tên gốc logic</li><li>Mỗi máy chủ tên gốc có một địa chỉ IP duy nhất được gán cho nó</li><li>Thực tế có nhiều máy chủ vật lý đằng sau mỗi địa chỉ IP</li><li>Thông qua anycast, chúng ta được định tuyến đến máy chủ gần nhất</li></ul><h3 id=2-tld-name-servers-máy-chủ-tên-miền-cấp-cao>2. TLD Name Servers (Máy chủ tên miền cấp cao)</h3><ul><li>Lưu trữ địa chỉ IP của các máy chủ tên có thẩm quyền cho tất cả các tên miền dưới chúng</li><li>Có nhiều loại tên TLD khác nhau:<ul><li>Các TLD phổ biến: .com, .org, .edu</li><li>Các TLD mã quốc gia: .de, .uk</li><li>Và nhiều loại khác</li></ul></li></ul><h3 id=3-authoritative-name-servers-máy-chủ-tên-có-thẩm-quyền>3. Authoritative Name Servers (Máy chủ tên có thẩm quyền)</h3><ul><li>Cung cấp câu trả lời có thẩm quyền cho các truy vấn DNS</li><li>Khi chúng ta đăng ký một tên miền, nhà đăng ký sẽ chạy các máy chủ tên có thẩm quyền theo mặc định</li><li>Chúng ta có thể thay đổi chúng thành các máy chủ khác</li><li>Các nhà cung cấp đám mây như AWS và Cloudflare chạy các máy chủ tên có thẩm quyền mạnh mẽ</li></ul><p>Thiết kế phân cấp này làm cho DNS có tính phi tập trung cao và mạnh mẽ.</p><h2 id=vòng-đời-của-một-truy-vấn-dns>Vòng đời của một truy vấn DNS</h2><p><img src=image1.png alt></p><p>Hãy cùng theo dõi vòng đời của một truy vấn DNS điển hình:</p><ol><li><p><strong>Người dùng nhập google.com vào trình duyệt</strong></p></li><li><p><strong>Trình duyệt kiểm tra cache của nó trước</strong></p></li><li><p><strong>Nếu không có câu trả lời, nó thực hiện lệnh gọi hệ điều hành để cố gắng lấy câu trả lời</strong></p></li><li><p><strong>Lệnh gọi hệ điều hành có thể có cache riêng của nó</strong></p></li><li><p><strong>Nếu câu trả lời không có ở đó, nó liên hệ với DNS resolver</strong></p></li><li><p><strong>DNS resolver kiểm tra cache của nó trước</strong></p></li><li><p><strong>Nếu không có hoặc câu trả lời đã hết hạn, nó hỏi máy chủ tên gốc</strong></p></li><li><p><strong>Máy chủ tên gốc phản hồi với danh sách các máy chủ tên TLD .com</strong></p></li><li><p><strong>DNS resolver sau đó liên hệ với máy chủ tên TLD .com</strong></p><ul><li>Lưu ý: Vì .com là TLD phổ biến, resolver có thể đã cache địa chỉ IP của các máy chủ tên TLD .com</li></ul></li><li><p><strong>Máy chủ tên TLD .com trả về các máy chủ tên có thẩm quyền cho google.com</strong></p></li><li><p><strong>Cuối cùng, DNS resolver liên hệ với máy chủ tên có thẩm quyền của google.com</strong></p></li><li><p><strong>Nó trả về địa chỉ IP của google.com</strong></p></li><li><p><strong>DNS resolver sau đó trả về địa chỉ IP cho hệ điều hành</strong></p></li><li><p><strong>Hệ điều hành trả về nó cho trình duyệt</strong></p></li></ol><h2 id=những-lưu-ý-khi-cập-nhật-dns-cho-hệ-thống-production>Những lưu ý khi cập nhật DNS cho hệ thống production</h2><p>Khi cập nhật bản ghi DNS cho một hệ thống production có lưu lượng truy cập cao, có một số điều cần lưu ý:</p><h3 id=vấn-đề-với-dns-propagation>Vấn đề với DNS Propagation</h3><p>DNS propagation chậm vì có TTL (Time To Live) trên mỗi bản ghi DNS. Một số TTL mặc định khá dài. Ngoài ra, không phải mọi DNS resolver đều là &ldquo;công dân tốt&rdquo; - có một số resolver không tuân thủ TTL.</p><h3 id=các-bước-thực-tế-để-giảm-thiểu-rủi-ro>Các bước thực tế để giảm thiểu rủi ro</h3><p>Để giảm thiểu rủi ro, có hai bước thực tế cần thực hiện:</p><h4 id=1-giảm-ttl-trước-khi-thay-đổi>1. Giảm TTL trước khi thay đổi</h4><p>Đầu tiên, giảm TTL cho bản ghi mà chúng ta muốn thay đổi xuống một giá trị rất ngắn, chẳng hạn như 60 giây, trước khi thực hiện cập nhật thực tế.</p><p>Điều này cho phép tất cả các máy chủ DNS có đủ thời gian để nhận TTL được rút ngắn, từ đó cho phép việc cập nhật bản ghi thực tế có hiệu lực dựa trên TTL mới được rút ngắn.</p><h4 id=2-giữ-máy-chủ-cũ-chạy>2. Giữ máy chủ cũ chạy</h4><p>Thứ hai, để máy chủ chạy trên địa chỉ IP cũ trong một thời gian. Chỉ ngừng hoạt động máy chủ khi lưu lượng truy cập giảm xuống mức có thể chấp nhận được.</p><p>Vì một số DNS resolver không tuân thủ TTL, điều này có thể mất một chút thời gian và sự kiên nhẫn.</p><h2 id=kết-luận>Kết luận</h2><p>DNS là thành phần quan trọng của xương sống internet. Thiết kế phân cấp của nó làm cho nó trở nên phi tập trung và mạnh mẽ.</p><p>Hãy nhớ rằng, DNS là thứ dịch tên miền thành địa chỉ IP, làm cho nó trở thành một thành phần quan trọng của xương sống internet.</p><p>Hiểu rõ cách DNS hoạt động sẽ giúp bạn thiết kế và vận hành các hệ thống phân tán tốt hơn, đặc biệt khi cần thực hiện các thay đổi DNS trong môi trường production.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/dns>dns</a></li><li><a href=/tags/networking>networking</a></li><li><a href=/tags/internet>internet</a></li></ul></nav></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/caubechankiu rel=me title=GitHub><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a><a class=soc href=https://www.facebook.com/trinhthevils rel=me title=Facebook><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#facebook"/></svg></a><a class=border></a></div><div class=footer-info>2025 © caubechankiu | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>