<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>ACID - caubechankiu's miscellaneous notes</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="ACID là viết tắt của Atomicity, Consistency, Isolation và Durability - bốn thuộc tính quan trọng đảm bảo các transaction trong database đáng tin cậy, ngay cả khi có sự cố xảy ra."><meta property="og:image" content><meta property="og:url" content="https://caubechankiu.github.io/posts/acid/"><meta property="og:site_name" content="caubechankiu's miscellaneous notes"><meta property="og:title" content="ACID"><meta property="og:description" content="ACID là viết tắt của Atomicity, Consistency, Isolation và Durability - bốn thuộc tính quan trọng đảm bảo các transaction trong database đáng tin cậy, ngay cả khi có sự cố xảy ra."><meta property="og:locale" content="vi_VN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-07T09:47:31+07:00"><meta property="article:modified_time" content="2022-07-07T09:47:31+07:00"><meta property="article:tag" content="Database"><meta name=twitter:card content="summary"><meta name=twitter:title content="ACID"><meta name=twitter:description content="ACID là viết tắt của Atomicity, Consistency, Isolation và Durability - bốn thuộc tính quan trọng đảm bảo các transaction trong database đáng tin cậy, ngay cả khi có sự cố xảy ra."><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://caubechankiu.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://caubechankiu.github.io/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link rel=stylesheet type=text/css href=https://caubechankiu.github.io/css/archie.90f4a1321261c2df9485c29a7877582160bb95d018fefaa5f2199bccf7b169f5.css></head><body><div class=content><header><div class=main><a href=https://caubechankiu.github.io/>caubechankiu's miscellaneous notes</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/tags>Tags</a>
| <span id=dark-mode-toggle onclick=toggleTheme()><svg class="feather"><use href="https://unpkg.com/feather-icons@4.29.2/dist/feather-sprite.svg#sun"/></svg></span>
<script src=https://caubechankiu.github.io/js/themetoggle.js></script></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>ACID</h1><div class=meta>Posted on Jul 7, 2022</div></div><section class=body><p>ACID là viết tắt của Tính nguyên tử (Atomicity), Tính nhất quán (Consistency), Tính cô lập (Isolation) và Tính bền vững (Durability) - bốn thuộc tính quan trọng đảm bảo các transaction trong database đáng tin cậy, ngay cả khi có sự cố xảy ra. Nếu bạn làm việc với database, việc hiểu ACID là điều bắt buộc.</p><h2 id=atomicity>Atomicity</h2><p>Tính nguyên tử (Atomicity) có nghĩa là một transaction là một thỏa thuận &ldquo;tất cả hoặc không có gì&rdquo;. Nếu bất kỳ phần nào của transaction thất bại, toàn bộ transaction sẽ bị rollback như chưa từng xảy ra. Các hệ thống quản lý transaction thường sử dụng cơ chế ghi log để hỗ trợ tính năng rollback này.</p><figure class=center><img src=/posts/acid/image1.png width=400px></figure><p>Hãy tưởng tượng bạn đang xây dựng một ứng dụng ngân hàng thực hiện chuyển <code>$100</code> từ Alice sang Bob. Điều này có nghĩa là cần cập nhật hai thứ - trừ <code>$100</code> từ số dư của Alice và cộng <code>$100</code> vào số dư của Bob.</p><figure class=center><img src=/posts/acid/image2.png width=600px></figure><p>Tính nguyên tử đảm bảo rằng cả hai cập nhật này hoặc xảy ra cùng nhau, hoặc không xảy ra. Nếu có lỗi xảy ra giữa chừng, hệ thống quản lý transaction sẽ sử dụng log để hoàn tác mọi thay đổi chưa hoàn thành, giúp tránh mất tiền hoặc phát sinh thêm tiền không hợp lệ. Transaction là không thể chia nhỏ, giống như một nguyên tử.</p><figure class=center><img src=/posts/acid/image3.png width=600px></figure><h2 id=consistency>Consistency</h2><p>Tính nhất quán (Consistency) có nghĩa là một transaction phải tuân theo tất cả các quy tắc và để lại database ở trạng thái hợp lệ. Bất kỳ dữ liệu nào được ghi trong một transaction phải hợp lệ theo các ràng buộc, trigger và các quy tắc khác mà chúng ta đã thiết lập. Hệ thống database tự động đảm bảo tính nhất quán bằng cách kiểm tra vi phạm ràng buộc trong quá trình thực hiện transaction.</p><figure class=center><img src=/posts/acid/image4.png width=300px></figure><p>Ví dụ, giả sử chúng ta có một quy tắc rằng số dư tài khoản người dùng không được âm. Nếu một transaction cố gắng rút nhiều tiền hơn số dư hiện có của người dùng, hệ thống database sẽ phát hiện vi phạm tính nhất quán này và hủy transaction để giữ cho database không bị sai lệch. Tính nhất quán giúp ngăn chặn dữ liệu không hợp lệ làm hỏng database.</p><figure class=center><img src=/posts/acid/image5.png width=500px></figure><h2 id=isolation>Isolation</h2><p>Tính cô lập (Isolation) liên quan đến cách các transaction đồng thời tương tác với nhau. Ngay cả khi nhiều transaction đang chạy cùng một lúc, tính cô lập làm cho mỗi transaction có cảm giác như nó đang sử dụng database một cách độc lập.</p><figure class=center><img src=/posts/acid/image6.png width=400px></figure><p>Mức độ cô lập cao nhất được gọi là &ldquo;serializable,&rdquo; trong đó các transaction được thực thi tuần tự, từng transaction một, như thể chúng đang xếp hàng lần lượt. Điều này cung cấp mức nhất quán mạnh nhất, nhưng có thể làm chậm hệ thống đáng kể vì mỗi transaction phải chờ đến lượt.</p><figure class=center><img src=/posts/acid/image7.png width=500px></figure><p>Để tăng tốc độ, các database thường cung cấp các mức cô lập thấp hơn, cho phép nhiều transaction chạy đồng thời. Nhưng có một vấn đề – các mức thấp hơn này đôi khi có thể dẫn đến sự không nhất quán, như <code>dirty read</code>, <code>non-repeatable read</code> và <code>phantom read</code>.</p><p><code>Dirty read</code> xảy ra khi một transaction nhìn thấy dữ liệu đã bị thay đổi bởi một transaction khác mà chưa được commit. Hãy tưởng tượng một tài khoản ngân hàng với <code>$100</code>. Transaction T1 rút <code>$20</code> nhưng không commit. Nếu Transaction T2 đọc số dư trước khi T1 commit, nó sẽ thấy <code>$80</code>. Nhưng nếu T1 rollback, số dư <code>$80</code> đó chưa bao giờ tồn tại - đó là <code>dirty read</code>.</p><figure class=center><img src=/posts/acid/image8.png width=500px></figure><p>Cấp độ isolation <code>read committed</code> ngăn chặn <code>dirty read</code> bằng cách đảm bảo một transaction chỉ có thể nhìn thấy dữ liệu đã commit.</p><figure class=center><img src=/posts/acid/image9.png width=500px></figure><p>Nhưng vẫn có thể có <code>non-repeatable read</code>, khi một transaction đọc dữ liệu hai lần và nhận kết quả khác nhau vì một transaction khác đã thay đổi dữ liệu giữa hai lần đọc. Ví dụ, bạn kiểm tra số dư tài khoản và thấy <code>$100</code>. Sau đó, một transaction khác rút <code>$50</code> và commit. Nếu bạn kiểm tra số dư một lần nữa trong cùng một transaction, bạn sẽ thấy <code>$50</code>. Đó là <code>non-repeatable read</code>.</p><figure class=center><img src=/posts/acid/image10.png width=500px></figure><p><code>Read committed</code> cũng có thể xảy ra <code>phantom read</code>, khi một transaction chạy lại một truy vấn và nhận kết quả khác vì một transaction khác đã thêm hoặc xóa row đó đi. Hãy tưởng tượng một transaction liệt kê tất cả các transaction chuyển khoản dưới <code>$100</code>. Trong khi đó, một transaction khác thêm một giao dịch <code>$50</code> và commit. Nếu transaction đầu chạy lại truy vấn của mình, nó sẽ thấy giao dịch <code>$50</code> mà trước đó không có - đó là <code>phantom read</code>.</p><figure class=center><img src=/posts/acid/image11.png width=500px></figure><p>Cấp độ isolation <code>repeatable read</code> ngăn chặn <code>non-repeatable read</code> bằng cách cung cấp một snapshot nhất quán của dữ liệu cho mỗi transaction. Nhưng vẫn có thể có <code>phantom read</code>. Vì vậy, các cấp độ isolation thấp hơn hi sinh tính nhất quán để có hiệu suất tốt hơn. Bạn cần chọn sự cân bằng phù hợp cho ứng dụng của mình, cân nhắc giữa tốc độ và sự thiếu nhất quán.</p><figure class=center><img src=/posts/acid/image12.png width=500px></figure><h2 id=durability>Durability</h2><p>Khi một transaction được commit, dữ liệu sẽ tồn tại ngay cả khi hệ thống gặp sự cố. Tính bền vững thường được thực hiện thông qua việc ghi transaction logs hoặc sử dụng write-ahead logging (WAL) để lưu thay đổi vào đĩa trước khi xác nhận commit.</p><figure class=center><img src=/posts/acid/image13.png width=600px></figure><p>Trong database phân tán, tính bền vững cũng bao gồm việc sao chép dữ liệu qua nhiều node. Vì vậy, nếu một node gặp sự cố, bạn không mất bất kỳ transaction nào đã commit - chúng được lưu trữ an toàn trên các node khác.</p><figure class=center><img src=/posts/acid/image14.png width=400px></figure></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/database>database</a></li></ul></nav></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/caubechankiu rel=me title=GitHub><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a><a class=soc href=https://www.facebook.com/trinhthevils rel=me title=Facebook><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#facebook"/></svg></a><a class=border></a></div><div class=footer-info>2025 © caubechankiu | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>